<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sanxin.cloud.mapper.BMoneyDetailMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.sanxin.cloud.entity.BMoneyDetail">
        <id column="id" property="id" />
        <result column="bid" property="bid" />
        <result column="pay_code" property="payCode" />
        <result column="type_id" property="typeId" />
        <result column="isout" property="isout" />
        <result column="original" property="original" />
        <result column="cost" property="cost" />
        <result column="last" property="last" />
        <result column="create_time" property="createTime" />
        <result column="target_id" property="targetId" />
        <result column="remark" property="remark" />
    </resultMap>


    <select id="getIncome" resultType="java.math.BigDecimal">
        SELECT IFNULL(sum(cost), 0) from b_money_detail
        where isout = 1 and bid = #{bid, jdbcType=INTEGER}
        <if test="type == 1">
            and date_format(create_time,'%Y-%m-%d')=date_format(NOW(),'%Y-%m-%d')
        </if>
        <if test="type == 2">
            and YEARWEEK(date_format(create_time,'%Y-%m-%d')) = YEARWEEK(NOW())
        </if>
        <if test="type == 3">
            and date_format(create_time,'%Y-%m')=date_format(NOW(),'%Y-%m')
        </if>
    </select>

    <select id="queryMoneyDetailList" resultMap="BaseResultMap">
        SELECT type_id, isout, cost, create_time
        FROM b_money_detail
        <where>
            <if test="param.bid != null">
                bid = #{param.bid, jdbcType=INTEGER }
            </if>
            <if test="param.isout != null">
                and isout = #{param.isout, jdbcType=INTEGER}
            </if>
            <if test="param.startTime !=null and param.startTime != '' and param.endTime != null and param.endTime != ''">
                and DATE_FORMAT(create_time,'%Y-%m-%d') &gt;=  DATE_FORMAT(#{param.startTime,jdbcType=VARCHAR},'%Y-%m-%d')
                and DATE_FORMAT(create_time,'%Y-%m-%d') &lt;=  DATE_FORMAT(#{param.endTime,jdbcType=VARCHAR},'%Y-%m-%d')
            </if>
        </where>
    </select>
</mapper>
